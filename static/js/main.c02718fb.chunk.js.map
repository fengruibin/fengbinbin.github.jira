{"version":3,"sources":["utils/index.ts","utils/http.ts","utils/use-async.ts","components/profiler.tsx","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","components/lib.tsx","context/auth-context.tsx"],"names":["cleanObject","object","result","Object","keys","forEach","key","value","undefined","isVoid","useMount","callback","useEffect","useDebounce","delay","useState","debouncedValue","setDebouncedValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnUnmount","oldTitle","useRef","document","current","resetRoute","window","location","href","origin","subset","obj","filteredEntries","entries","filter","includes","fromEntries","useMountedRef","mountedRef","apiUrl","process","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","fetch","then","response","status","auth","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defaultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","dispatch","useSafeDispatch","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isIdle","isLoading","isError","isSuccess","queue","setInterval","length","queueToSend","console","log","Profiler","metadata","phases","props","onRender","id","phase","actualDuration","baseDuration","startTime","commitTime","interactions","push","ErrorBoundary","this","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","queryClient","QueryClient","defaultOptions","queries","refetchOnWindowFocus","client","loadServer","ReactDOM","render","StrictMode","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","Row","styled","div","between","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","Text","type","ButtonNoPadding","Button","ScreenContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","useQueryClient","Provider","form","clear","context","useContext"],"mappings":"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","file":"static/js/main.c02718fb.chunk.js","sourcesContent":["import { useEffect, useState, useRef } from \"react\";\n\nexport const isFalsy = (value: unknown) => (value === 0 ? false : !value);\nexport const isVoid = (value: unknown) => value === undefined || value === null || value === '';\n\n//在一个函数里，改变传入的对象本身是不好的\nexport const cleanObject = (object?: { [key: string]: unknown }) => {\n  //Object.assign({}, object)\n  if (!object) {\n    return {}\n  }\n  const result = { ...object }\n  Object.keys(result).forEach(key => {\n    const value = result[key]\n    if (isVoid(value)) {\n      delete result[key]\n    }\n  })\n  return result\n};\n\nexport const useMount = (callback: () => void) => {\n  useEffect(() => {\n    callback()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [callback])\n}\n\nexport const useDebounce = (<V>(value: V, delay?: number) => {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n  useEffect(() => {\n    const timeout = setTimeout(() => { setDebouncedValue(value) }, delay)\n    return () => clearTimeout(timeout)\n  }, [value, delay])\n  return debouncedValue\n})\n\nexport const useArray = <T>(initialArray: T[]) => {\n  const [value, setValue] = useState(initialArray)\n  return {\n    value,\n    setValue,\n    add: (item: T) => setValue([...value, item]),\n    clear: () => setValue([]),\n    removeIndex: (index: number) => {\n      const copy = [...value];\n      copy.splice(index, 1);\n      setValue(copy);\n    }\n  }\n}\n\nexport const useDocumentTitle = (title: string, keepOnUnmount = true) => {\n  const oldTitle = useRef(document.title).current;\n\n  useEffect(() => {\n    document.title = title\n  }, [title])\n\n  useEffect(() => {\n    return () => {\n      if (!keepOnUnmount) {\n        //如果不指定依赖，读到的就是旧title\n        document.title = oldTitle\n      }\n    }\n  }, [keepOnUnmount, oldTitle])\n}\n\nexport const resetRoute = () => (window.location.href = window.location.origin);\n\n/**\n * 传入一个对象，和键集合，返回对应的对象中的键值对\n * @param obj\n * @param keys\n */\nexport const subset = <\n  O extends { [key in string]: unknown },\n  K extends keyof O\n>(\n  obj: O,\n  keys: K[]\n) => {\n  const filteredEntries = Object.entries(obj).filter(([key]) =>\n    keys.includes(key as K)\n  );\n  return Object.fromEntries(filteredEntries) as Pick<O, K>;\n};\n\nexport const useMountedRef = () => {\n  const mountedRef = useRef(false);\n\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  });\n\n  return mountedRef;\n};","import qs from 'qs';\nimport * as auth from 'auth-provider';\nimport { useAuth } from 'context/auth-context';\nimport { useCallback } from 'react';\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\ninterface Config extends RequestInit {\n  token?: string;\n  data?: object;\n}\n\nexport const http = async (endpoint: string, { data, token, headers, ...customConfig }: Config = {}) => {\n  const config = {\n    method: 'GET',\n    headers: {\n      Authorization: token ? `Bearer ${token}` : '',\n      'Content-Type': data ? 'application/json' : '',\n    },\n    ...customConfig,\n  }\n\n  if (config.method.toUpperCase() === 'GET') {\n    endpoint += `?${qs.stringify(data)}`\n  } else {\n    config.body = JSON.stringify(data || {})\n  }\n  //axios和fetch的表现不一样，axios可以直接在返回状态不为2xx的时候抛出异常\n  return window.fetch(`${apiUrl}/${endpoint}`, config)\n    .then(async (response) => {\n      if (response.status === 401) {\n        await auth.logout()\n        window.location.reload()\n        return Promise.reject({ message: '请重新登录' })\n      }\n      const data = await response.json()\n      if (response.ok) {\n        return data\n      } else {\n        return Promise.reject(data)\n      }\n    })\n}\n// return (...[endpoint, config]: Parameters<typeof http>) =>\nexport const useHttp = () => {\n  const { user } = useAuth()\n  //TODO 讲解 TS Utility Types\n  return useCallback(\n    (...[endpoint, config]: Parameters<typeof http>) =>\n      http(endpoint, { ...config, token: user?.token }),\n    [user?.token]\n  )\n}\n\n// 类型别名、Utility Type 讲解\n// 联合类型\nlet myFavoriteNumber: string | number;\nmyFavoriteNumber = \"seven\";\nmyFavoriteNumber = 7;\n// TS2322: Type '{}' is not assignable to type 'string | number'.\n// myFavoriteNumber = {}\nlet jackFavoriteNumber: string | number;\n\n// 类型别名在很多情况下可以和interface互换\n// interface Person {\n//   name: string\n// }\n// type Person = { name: string }\n// const xiaoMing: Person = {name: 'xiaoming'}\n\n// 类型别名, interface 在这种情况下没法替代type\ntype FavoriteNumber = string | number;\nlet roseFavoriteNumber: FavoriteNumber = \"6\";\n\ntype Person = {\n  name: string;\n  age: number;\n};\nconst xiaoMing: Partial<Person> = {};\nconst shenMiRen: Omit<Person, \"name\" | \"age\"> = {};\ntype PersonKeys = keyof Person;\ntype PersonOnlyName = Pick<Person, \"name\" | \"age\">;\ntype Age = Exclude<PersonKeys, \"name\">;\n\ntype Partial<T> = {\n  [P in keyof T]?: T[P];\n};","import { useState, useCallback, useReducer } from \"react\";\nimport { useMountedRef } from 'utils/index';\n\ninterface State<D> {\n  error: Error | null;\n  data: D | null;\n  stat: 'idle' | 'loading' | 'error' | 'success';\n}\n\nconst defaultInitialState: State<null> = {\n  stat: 'idle',\n  data: null,\n  error: null\n}\n\nconst defaultConfig = {\n  throwOnError: false\n}\n\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\n  const mountedRef = useMountedRef()\n  return useCallback(\n    (...args: T[]) => (mountedRef.current ? dispatch(...args) : void 0),\n    [dispatch, mountedRef]\n  )\n}\n\nexport const useAsync = <D>(initialState?: State<D>, initialConfig?: typeof defaultConfig) => {\n  const config = { ...defaultConfig, ...initialConfig }\n  const [state, dispatch] = useReducer((state: State<D>, action: Partial<State<D>>) => ({ ...state, ...action }), {\n    ...defaultInitialState,\n    ...initialState\n  })\n\n  const safeDispatch = useSafeDispatch(dispatch);\n\n  const [retry, setRetry] = useState(() => () => { })\n\n  const setData = useCallback(\n    (data: D) => safeDispatch({\n      data,\n      stat: 'success',\n      error: null\n    }), [safeDispatch]);\n\n  const setError = useCallback(\n    (error: Error) => safeDispatch({\n      error,\n      stat: 'error',\n      data: null\n    }), [safeDispatch]);\n  //run用来触发异步请求\n  const run = useCallback((promise: Promise<D>, runConfig?: { retry: () => Promise<D> }) => {\n    if (!promise || !promise.then) {\n      throw new Error('请传入Promise类型数据')\n    }\n    setRetry(() => () => {\n      if (runConfig?.retry) {\n        run(runConfig?.retry(), runConfig)\n      }\n    });\n    safeDispatch({ stat: \"loading\" });\n    return promise.then(data => {\n      setData(data);\n      return data\n    })\n      .catch(error => {\n        //catch会消化异常,如果不主动抛出，外面是接收不到异常的\n        setError(error)\n        if (config.throwOnError) return Promise.reject(error)\n        return error;\n      })\n  },\n    [config.throwOnError, safeDispatch, setData, setError]\n  );\n\n  return {\n    isIdle: state.stat === 'idle',\n    isLoading: state.stat === 'loading',\n    isError: state.stat === 'error',\n    isSuccess: state.stat === 'success',\n    run,\n    setData,\n    setError,\n    retry,\n    ...state\n  }\n}","import React, { ProfilerOnRenderCallback, ProfilerProps } from \"react\";\n\ntype Props = { metadata?: any, phases?: ('mount' | 'update')[] } & Omit<ProfilerProps, \"onRender\">\n\nlet queue: unknown[] = []\n\nconst sendProfileQueue = () => {\n  if (!queue.length) {\n    return\n  }\n  const queueToSend = [...queue]\n  queue = []\n  console.log(queueToSend)\n}\n\nsetInterval(sendProfileQueue, 200)\n\nexport const Profiler = ({ metadata, phases, ...props }: Props) => {\n\n  const reportProfile: ProfilerOnRenderCallback = (\n    id,\n    phase,\n    actualDuration,\n    baseDuration,\n    startTime,\n    commitTime,\n    interactions\n  ) => {\n    if (!phase || phases?.includes(phase)) {\n      queue.push({\n        id,\n        phase,\n        actualDuration,\n        baseDuration,\n        startTime,\n        commitTime,\n        interactions,\n        metadata\n      })\n    }\n  }\n\n  return <React.Profiler onRender={reportProfile} {...props} />\n}","import React from \"react\";\n\ntype FallbackRender = (props: { error: Error | null }) => React.ReactElement;\nexport class ErrorBoundary extends React.Component<React.PropsWithChildren<{ fallbackRender: FallbackRender }>, { error: Error | null }> {\n  state = { error: null }\n\n  //当子组件抛出异常，这里会接收到并且调用\n  static getDerivedStateFromError(error: Error) {\n    return { error }\n  }\n\n  render() {\n    const { error } = this.state\n    const { fallbackRender, children } = this.props\n    if (error) {\n      return fallbackRender({ error })\n    }\n    return children\n  }\n}","import React from 'react';\nimport './App.css';\nimport { useAuth } from 'context/auth-context';\nimport { ErrorBoundary } from 'components/error-boundary';\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib';\n\nconst AuthenticatedApp = React.lazy(() => import('authenticated-app'))\nconst UnauthenticatedApp = React.lazy(() => import('unauthenticated-app'))\n\nfunction App() {\n  const { user } = useAuth()\n\n  return (\n    <div className=\"App\">\n      <ErrorBoundary fallbackRender={FullPageErrorFallback}>\n        <React.Suspense fallback={<FullPageLoading />}>;\n          {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\n        </React.Suspense>\n      </ErrorBoundary>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { ReactNode } from \"react\";\nimport { AuthProvider } from \"./auth-context\";\nimport { QueryClient, QueryClientProvider } from \"react-query\";\nimport { BrowserRouter as Router } from \"react-router-dom\";\n\n\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        refetchOnWindowFocus: false\n      }\n    }\n  })\n\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <Router>\n        <AuthProvider>{children}</AuthProvider>\n      </Router>\n    </QueryClientProvider>\n  )\n}","import './wdyr';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { loadServer, DevTools } from 'jira-dev-tool';\n//务必在jira-dev-tool后引入\nimport 'antd/dist/antd.less';\nimport { AppProviders } from 'context';\nimport { Profiler } from 'components/profiler';\n\nloadServer(() => ReactDOM.render(\n  <React.StrictMode>\n    <Profiler id={\"Root App\"} phases={['mount']}>\n      <AppProviders>\n        <DevTools />\n        <App />\n      </AppProviders>\n    </Profiler>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n)\n\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","//在真实环境中，如果使用firebase这种第三方auth服务的话，本文件不需要开发者开发\nimport { User } from 'types/user';\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\nconst localStorageKey = '__auth_provider_token__';\n\nexport const getToken = () => window.localStorage.getItem(localStorageKey)\n\nexport const handleUserResponse = ({ user }: { user: User }) => {\n  window.localStorage.setItem(localStorageKey, user.token || '')\n  return user\n}\n\nexport const login = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/login`, {\n    method: 'POST',\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async response => {\n    if (response.ok) {\n      return handleUserResponse(await response.json())\n    } else {\n      return Promise.reject(await response.json())\n    }\n  })\n}\n\nexport const register = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/register`, {\n    method: 'POST',\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify(data),\n  }).then(async response => {\n    if (response.ok) {\n      return handleUserResponse(await response.json())\n    } else {\n      return Promise.reject(await response.json())\n    }\n  })\n}\n\nexport const logout = async () => window.localStorage.removeItem(localStorageKey)","import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport { Button, Spin, Typography } from \"antd\";\nimport { DevTools } from \"jira-dev-tool\";\n\nexport const Row = styled.div <{ gap?: number | boolean, between?: boolean, marginBottom?: number }>`\n  display: flex;\n  align-items: center;\n  justify-content: ${props => props.between ? 'space-between' : undefined};\n  margin-bottom: ${props => props.marginBottom + 'rem'};\n  > * {\n    margin-top: 0 !important;\n    margin-bottom: 0 !important;\n    margin-right: ${props => typeof props.gap === 'number' ? props.gap + 'rem' : props.gap ? '2rem' : undefined};\n  }\n`\n\nconst FullPage = styled.div`\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`\n\nexport const FullPageLoading = () => <FullPage>\n  <Spin size=\"large\" />\n</FullPage>\n\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => <FullPage>\n  <DevTools />\n  <ErrorBox error={error} />\n</FullPage>\n\nconst isError = (value: any): value is Error => value?.message;\n\nexport const ErrorBox = ({ error }: { error: unknown }) => {\n  if (isError(error)) {\n    return <Typography.Text type={'danger'}>{error?.message}</Typography.Text>\n  }\n  return null\n}\n\nexport const ButtonNoPadding = styled(Button)`\n  padding: 0;\n`\n\nexport const ScreenContainer = styled.div`\n  padding: 3.2rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n`","import React, { ReactNode, useCallback } from 'react';\nimport * as auth from 'auth-provider';\nimport { User } from \"types/user\";\nimport { useMount } from 'utils';\nimport { http } from 'utils/http';\nimport { useAsync } from 'utils/use-async';\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib';\nimport { useQueryClient } from 'react-query';\n\n\ninterface AuthForm {\n  username: string;\n  password: string;\n}\n\nconst bootstrapUser = async () => {\n  let user = null\n  const token = auth.getToken()\n  if (token) {\n    const data = await http('me', { token })\n    user = data.user\n  }\n  return user\n}\n\nconst AuthContext = React.createContext<\n  | {\n    user: User | null,\n    register: (form: AuthForm) => Promise<void>,\n    login: (form: AuthForm) => Promise<void>,\n    logout: () => Promise<void>,\n  } | undefined>(undefined)\nAuthContext.displayName = 'AuthContext'\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const { data: user, error, isLoading, isIdle, isError, run, setData: setUser } = useAsync<User | null>()\n  const queryClient = useQueryClient()\n  const login = (form: AuthForm) => auth.login(form).then(setUser)\n  const register = (form: AuthForm) => auth.register(form).then(setUser)\n  const logout = () => auth.logout().then(() => {\n    setUser(null);\n    queryClient.clear()\n  });\n\n  useMount(\n    useCallback(() => {\n      run(bootstrapUser())\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [])\n  );\n\n  if (isIdle || isLoading) {\n    return <FullPageLoading />\n  }\n\n  if (isError) {\n    return <FullPageErrorFallback error={error} />\n  }\n\n  return (\n    <AuthContext.Provider children={children} value={{ user, login, register, logout }} />\n  )\n}\n\nexport const useAuth = () => {\n  const context = React.useContext(AuthContext)\n  if (!context) {\n    throw new Error('useAuth必须在AuthProvider中使用')\n  }\n  return context\n}"],"sourceRoot":""}